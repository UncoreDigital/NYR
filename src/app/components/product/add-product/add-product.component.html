<div class="page-layout">
    <app-sidebar></app-sidebar>
    <div class="main-content">
        <app-header></app-header>
        <div class="content">
            <!-- Breadcrumb -->
            <div class="breadcrumb flex items-center space-x-2 text-gray-600">
                <a class="breadcrumb-item hover:text-blue-600 cursor-pointer active">
                    Settings
                </a>
                <mat-icon class="breadcrumb-separator text-gray-400">chevron_right</mat-icon>

                <a routerLink="/van" class="breadcrumb-item hover:text-blue-600 cursor-pointer active">
                    Product
                </a>
                <mat-icon class="breadcrumb-separator text-gray-400">chevron_right</mat-icon>

                <span class="breadcrumb-item text-gray-800 font-semibold active">
                    Add Product
                </span>
            </div>

            <!-- Page Header -->
            <div class="page-header">
                <h1>{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h1>
            </div>

            <div class="table-container">
                <!-- Loading Overlay -->
                <div *ngIf="isLoading" class="loading-overlay">
                    <div class="loading-content">
                        <div class="loading-spinner-large"></div>
                        <p>{{ isEditMode ? 'Updating product...' : 'Adding product...' }}</p>
                    </div>
                </div>

                <!-- Product Loading Overlay -->
                <div *ngIf="isLoadingProduct" class="loading-overlay">
                    <div class="loading-content">
                        <div class="loading-spinner-large"></div>
                        <p>Loading product...</p>
                    </div>
                </div>
                
                <form [formGroup]="productForm" class="user-form" (ngSubmit)="onSubmit()" [class.loading]="isLoading">
                    <div style="display:flex; gap:32px;">
                        <!-- Left Column -->
                        <div style="flex:2;">
                            <div class="form-group">
                                <label>Product Name</label>
                                <input type="text" formControlName="productName" class="form-control"
                                    placeholder="Enter product name" />
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea formControlName="description" class="form-control" rows="3"
                                    placeholder="Description"></textarea>
                            </div>
                        </div>
                        <!-- Right Column: Upload Image -->
                        <div style="flex:1;">
                            <label style="font-weight:500;">Upload Image</label>
                            
                            <!-- Image Preview -->
                            <div *ngIf="imagePreview" class="image-preview-container">
                                <img [src]="imagePreview" alt="Product Preview" class="image-preview">
                                <button type="button" class="remove-image-btn" (click)="removeImage()" title="Remove Image">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </div>
                            
                            <!-- Upload Area -->
                            <div *ngIf="!imagePreview" 
                                class="upload-area" 
                                [class.uploading]="isUploadingImage"
                                (click)="fileInput.click()">
                                <input #fileInput type="file" accept="image/*" (change)="onImageSelected($event)" style="display: none;">
                                
                                <div *ngIf="!isUploadingImage" class="upload-content">
                                    <mat-icon class="upload-icon">cloud_upload</mat-icon>
                                    <span class="upload-text">Click to browse or drag & drop</span>
                                    <span class="upload-hint">Supports: JPEG, PNG, GIF, WebP (Max 5MB)</span>
                                </div>
                                
                                <div *ngIf="isUploadingImage" class="upload-loading">
                                    <div class="upload-spinner"></div>
                                    <span>Processing image...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Barcode (SKU)</label>
                            <div style="position:relative;">
                                <input type="text" formControlName="sku1" class="form-control"
                                    placeholder="Enter SKU" />
                                <button type="button"
                                    style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:none; border:none;">
                                    <mat-icon>photo_camera</mat-icon>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Barcode (SKU #2)</label>
                            <div style="position:relative;">
                                <input type="text" class="form-control" formControlName="sku2"
                                    placeholder="Enter SKU" />
                                <button type="button"
                                    style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:none; border:none;">
                                    <mat-icon>photo_camera</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex:1;">
                            <label>Barcode (SKU #3)</label>
                            <div style="position:relative;">
                                <input type="text" class="form-control" formControlName="sku3"
                                    placeholder="Enter SKU" />
                                <button type="button"
                                    style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:none; border:none;">
                                    <mat-icon>photo_camera</mat-icon>
                                </button>
                            </div>
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label>Barcode (SKU #4)</label>
                            <div style="position:relative;">
                                <input type="text" class="form-control" formControlName="sku4"
                                    placeholder="Enter SKU" />
                                <button type="button"
                                    style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:none; border:none;">
                                    <mat-icon>photo_camera</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Category</label>
                            <select class="form-control" formControlName="category" [disabled]="isLoadingDropdowns">
                                <option value="" disabled selected>Select a Category</option>
                                <option *ngFor="let category of categories" [value]="category.name">
                                    {{ category.name }}
                                </option>
                            </select>
                            <div *ngIf="isLoadingDropdowns" class="dropdown-loading">
                                <span class="loading-text">Loading categories...</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Brand</label>
                            <select class="form-control" formControlName="brand" [disabled]="isLoadingDropdowns">
                                <option value="" disabled selected>Select a Brand</option>
                                <option *ngFor="let brand of brands" [value]="brand.name">
                                    {{ brand.name }}
                                </option>
                            </select>
                            <div *ngIf="isLoadingDropdowns" class="dropdown-loading">
                                <span class="loading-text">Loading brands...</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex:1;">
                            <label>Supplier</label>
                            <select class="form-control" formControlName="supplier" [disabled]="isLoadingDropdowns">
                                <option value="" disabled selected>Select a Supplier</option>
                                <option *ngFor="let supplier of suppliers" [value]="supplier.name">
                                    {{ supplier.name }}
                                </option>
                            </select>
                            <div *ngIf="isLoadingDropdowns" class="dropdown-loading">
                                <span class="loading-text">Loading suppliers...</span>
                            </div>
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label>Price</label>
                            <input type="text" formControlName="price" class="form-control" placeholder="Enter Price" />
                        </div>
                    </div>

                    <div class="form-row">
                        <div style="display:flex; align-items:center; gap:8px; margin-bottom: 20px;">
                            <label style="font-weight:500;">Show in Catalogue</label>
                            <mat-slide-toggle formControlName="showInCatalogue"></mat-slide-toggle>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px; margin-bottom: 20px">
                            <label style="font-weight:500;">Universal</label>
                            <mat-slide-toggle (change)="onUniversalToggle($event)"></mat-slide-toggle>
                        </div>
                    </div>
                    <div class="form-row" *ngIf="!universal">
                        <div class="form-group" style="flex:1;">
                            <label>Add Variation</label>
                            <select class="form-control" formControlName="variation">
                                <option>Select Variation</option>
                                <option>Size</option>
                                <option>Color</option>
                                <option>Test</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex:1;">
                            <label>&nbsp;</label>
                            <button type="button" class="btn btn-outline" style="height:40px; width:40px; padding:0;"
                                (click)="addVariationClick()">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>

                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                            <span *ngIf="isLoading" class="loading-spinner"></span>
                            {{ isLoading ? (isEditMode ? 'Updating Product...' : 'Adding Product...') : (isEditMode ? 'Update Product' : 'Add Product') }}
                        </button>
                        <button type="button" class="btn btn-outline" [disabled]="isLoading">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop" id="addVariation" *ngIf="addVariation">
    <div class="modal-success">
        <h2 style="text-align:left; font-size:1.2rem; font-weight:600; margin-bottom:24px;">Add Variation
        </h2>
        <div class="form-row">
            <div class="form-group" style="flex:1;">
                <label style="text-align: left;">Variation Name</label>
                <input type="text" [(ngModel)]="variationNm" class="form-control" placeholder="Enter Variation Name" />
            </div>
        </div>
        <div style="display:flex; gap:18px; justify-content:center;">
            <button class="btn btn-primary" (click)="saveProductAvailability()">Done</button>
            <button class="btn btn-outline" (click)="closeProductAvailability()">Cancel</button>
        </div>
    </div>
</div>
<div class="modal-backdrop" *ngIf="showSuccess">
    <div class="modal-success">
        <div class="modal-icon">
            <mat-icon>check_circle</mat-icon>
        </div>
        <div class="modal-message">
            <h2>Product has been successfully {{ isEditMode ? 'updated' : 'added' }}.</h2>
        </div>
        <div class="modal-actions">
            <button *ngIf="!isEditMode" class="btn btn-primary" (click)="addAnotherProduct()">Add Another Product</button>
            <button class="btn btn-outline" (click)="goToProductsList()">Go to Products List</button>
        </div>
    </div>
</div>