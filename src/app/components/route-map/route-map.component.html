<!-- Full page layout when used as a standalone page -->
<div class="page-layout" *ngIf="showFullLayout">
    <app-sidebar></app-sidebar>
    <div class="main-content">
        <app-header></app-header>
        <div class="content">
            <!-- Breadcrumb -->
             <div class="breadcrumb flex items-center space-x-2 text-gray-600">
                <a routerLink="/routes" class="breadcrumb-item hover:text-blue-600 cursor-pointer active">
                    Routes
                </a>
                <mat-icon class="breadcrumb-separator text-gray-400">chevron_right</mat-icon>

                <a class="breadcrumb-item hover:text-blue-600 cursor-pointer active">
                    {{routeData?.driverName}}
                </a>
            </div>

            <!-- Route Header -->
            <div class="route-header">
                <div class="route-title">
                    <h1>Route A | {{ routeData?.driverName }}</h1>
                </div>
                <div class="route-actions">
                    <button class="btn btn-outline" (click)="goBack()">
                        Back to Routes
                    </button>
                </div>
            </div>

            <!-- Route Content -->
            <div class="route-content">
                <ng-container *ngTemplateOutlet="mapContent"></ng-container>
            </div>
        </div>
    </div>
</div>

<!-- Component-only layout when used within other components -->
<div class="route-content" *ngIf="!showFullLayout">
    <ng-container *ngTemplateOutlet="mapContent"></ng-container>
</div>

<!-- Map Content Template -->
<ng-template #mapContent>
                <!-- Map Section -->
                <div class="map-section">
                    <div class="map-container">
                        <div id="map" class="route-map"></div>
                        <!-- <div class="map-overlay">
                            <div class="route-progress">
                                <div class="progress-item">
                                    <mat-icon>schedule</mat-icon>
                                    <span>{{ getTotalTime() }}</span>
                                </div>
                                <div class="progress-item">
                                    <mat-icon>straighten</mat-icon>
                                    <span>{{ routeData?.distance || '5.1 miles' }}</span>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </div>

                <!-- Route Details Section -->
                <div class="details-section">
                    <!-- Stops List -->
                    <div class="stops-section">
                        <h3>Route Stops</h3>
                        <div class="stops-list">
                            <div class="stop-item" 
                                 *ngFor="let stop of routeStops; let i = index"
                                 [class.completed]="stop.status === 'completed'"
                                 [class.in-transit]="stop.status === 'in-transit'"
                                 [class.pending]="stop.status === 'pending'">
                                <div class="stop-header">
                                    <div style="color: #02c3b4; font-weight: 500;">
                                        <span>Stop {{ i + 1 }}</span>
                                    </div>
                                    <div class="stop-status">
                                        <span class="status-badge" [class]="stop.status">
                                            {{ stop.status | titlecase }}
                                        </span>
                                    </div>
                                </div>
                                <div class="stop-details">
                                    <div class="stop-location">{{ stop.location }}</div>
                                    <div class="stop-meta-row">
                                        <div class="stop-eta">ETA {{ stop.eta }}</div>
                                        <div class="stop-distance" *ngIf="stop.distance">{{ stop.distance }}</div>
                                    </div>
                                    <div class="stop-inventory-row">
                                        <div class="stop-location-inventory" *ngIf="stop.locationInventory">
                                            <span class="label">Location Inventory:</span>
                                            <span class="value inventory-link" (click)="openLocationInventoryModal(stop); $event.stopPropagation()">{{ stop.locationInventory }}</span>
                                        </div>
                                        <div class="stop-shipping-inventory" *ngIf="stop.shippingInventory">
                                            <span class="label">Shipping Inventory:</span>
                                            <span class="value shipping-link" (click)="openShippingInventoryModal(stop); $event.stopPropagation()">{{ stop.shippingInventory }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Stop Button -->
                    <div class="add-stop-section">
                        <button class="btn btn-primary add-stop-btn" (click)="openAddStopModal()">
                            Add Stop
                        </button>
                    </div>
                </div>
</ng-template>

<!-- Add Stop Modal -->
<div class="modal-backdrop" *ngIf="showAddStopModal" (click)="closeAddStopModal()">
    <div class="add-stop-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Select Customers</h3>
            <button class="close-btn" (click)="closeAddStopModal()">
                <mat-icon>close</mat-icon>
            </button>
        </div>
        
        <div class="modal-content">
            <div class="customer-list">
                <div class="customer-header">
                    <div class="select-all-container">
                        <input type="checkbox" 
                               id="selectAll"
                               [checked]="areAllCustomersSelected()"
                               [indeterminate]="isSomeCustomersSelected()"
                               (change)="toggleAllCustomers($event)">
                        <label for="selectAll">CUSTOMER NAME</label>
                    </div>
                    <div class="status-header">STATUS</div>
                </div>
                
                <div class="customer-items">
                    <div class="customer-item" *ngFor="let customer of availableCustomers; let i = index">
                        <div class="customer-info">
                            <input type="checkbox" 
                                   [id]="'customer-' + i"
                                   [(ngModel)]="customer.selected"
                                   (change)="onCustomerSelectionChange()">
                            <label [for]="'customer-' + i" class="customer-name">
                                {{ customer.name }}
                            </label>
                        </div>
                        <div class="customer-status">
                            <span class="status-badge" [class]="customer.status.toLowerCase().toLowerCase().split(' ').join('-')">
                                {{ customer.status }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-outline" (click)="closeAddStopModal()">Cancel</button>
            <button class="btn btn-primary" 
                    (click)="addSelectedCustomersToStops()"
                    [disabled]="!hasSelectedCustomers()">
                Create
            </button>
        </div>
    </div>
</div>

<!-- Product Details Modal -->
<div class="modal-overlay inventory-modal" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">{{ modalTitle }}</h3>
            <button class="close-btn" (click)="closeModal()">
                <mat-icon>close</mat-icon>
            </button>
        </div>

        <div class="modal-content">
            <div class="modal-table-container">
                <table mat-table [dataSource]="productDetails" class="product-table">
                    <ng-container matColumnDef="productName">
                        <th mat-header-cell *matHeaderCellDef>PRODUCT NAME</th>
                        <td mat-cell *matCellDef="let product">{{product.productName}}</td>
                    </ng-container>

                    <ng-container matColumnDef="skuCode">
                        <th mat-header-cell *matHeaderCellDef>SKU/CODE</th>
                        <td mat-cell *matCellDef="let product">{{product.skuCode}}</td>
                    </ng-container>

                    <ng-container matColumnDef="size">
                        <th mat-header-cell *matHeaderCellDef>SIZE</th>
                        <td mat-cell *matCellDef="let product">{{product.size}}</td>
                    </ng-container>

                    <ng-container matColumnDef="side">
                        <th mat-header-cell *matHeaderCellDef>SIDE</th>
                        <td mat-cell *matCellDef="let product">{{product.side}}</td>
                    </ng-container>

                    <ng-container matColumnDef="colour">
                        <th mat-header-cell *matHeaderCellDef>COLOUR</th>
                        <td mat-cell *matCellDef="let product">{{product.colour}}</td>
                    </ng-container>

                    <ng-container matColumnDef="quantity">
                        <th mat-header-cell *matHeaderCellDef>QUANTITY</th>
                        <td mat-cell *matCellDef="let product">{{product.quantity}}</td>
                    </ng-container>

                    <ng-container matColumnDef="inStock">
                        <th mat-header-cell *matHeaderCellDef>IN STOCK</th>
                        <td mat-cell *matCellDef="let product">{{product.inStock}}</td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="productDisplayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: productDisplayedColumns;"></tr>
                </table>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-outline" (click)="closeModal()">Close</button>
        </div>
    </div>
</div>