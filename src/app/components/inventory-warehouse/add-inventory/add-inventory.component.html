<div class="page-layout">
    <app-sidebar></app-sidebar>
    <div class="main-content">
        <app-header></app-header>
        <div class="content">

            <!-- Breadcrumb -->
            <div class="breadcrumb flex items-center space-x-2 text-gray-600">
                <a class="breadcrumb-item hover:text-blue-600 cursor-pointer active">
                    Inventory
                </a>
                <mat-icon class="breadcrumb-separator text-gray-400">chevron_right</mat-icon>

                <a routerLink="/warehouse" class="breadcrumb-item hover:text-blue-600 cursor-pointer active">
                    Warehouse
                </a>
                <mat-icon class="breadcrumb-separator text-gray-400">chevron_right</mat-icon>

                <span class="breadcrumb-item text-gray-800 font-semibold active">
                    Add Inventory
                </span>
            </div>

            <!-- Page Header -->
            <div class="page-header">
                <h1>Add Inventory</h1>
            </div>

            <div class="table-container">
                <form [formGroup]="inventoryForm" class="user-form" (ngSubmit)="onSubmit()">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Select Warehouse</label>
                            <div class="custom-select-container">
                                <div class="search-wrapper">
                                    <mat-icon class="search-icon">search</mat-icon>
                                    <input type="text" 
                                           class="search-input" 
                                           [(ngModel)]="warehouseSearchTerm" 
                                           [ngModelOptions]="{standalone: true}"
                                           placeholder="Search and select warehouse..."
                                           (focus)="showWarehouseDropdown = true"
                                           (blur)="hideWarehouseDropdown()"
                                           (input)="filterWarehouses()">
                                    <button type="button" 
                                            class="clear-button" 
                                            *ngIf="selectedWarehouse"
                                            (click)="clearWarehouse()"
                                            title="Clear selection">
                                        <mat-icon>close</mat-icon>
                                    </button>
                                </div>
                                <div class="dropdown-list" *ngIf="showWarehouseDropdown && getFilteredWarehouses().length > 0">
                                    <div class="dropdown-item" 
                                         *ngFor="let warehouse of getFilteredWarehouses()"
                                         (mousedown)="selectWarehouse(warehouse)"
                                         [class.selected]="selectedWarehouse?.value === warehouse.value">
                                        {{warehouse.name}}
                                    </div>
                                </div>
                                <div class="dropdown-list" *ngIf="showWarehouseDropdown && getFilteredWarehouses().length === 0">
                                    <div class="dropdown-item no-results">No warehouses found</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Select Product</label>
                            <div class="custom-select-container">
                                <div class="search-wrapper">
                                    <mat-icon class="search-icon">search</mat-icon>
                                    <input type="text" 
                                           class="search-input" 
                                           [(ngModel)]="productSearchTerm" 
                                           [ngModelOptions]="{standalone: true}"
                                           placeholder="Search and select product..."
                                           (focus)="showProductDropdown = true"
                                           (blur)="hideProductDropdown()"
                                           (input)="filterProducts()">
                                    <button type="button" 
                                            class="clear-button" 
                                            *ngIf="selectedProduct"
                                            (click)="clearProduct()"
                                            title="Clear selection">
                                        <mat-icon>close</mat-icon>
                                    </button>
                                </div>
                                <div class="dropdown-list" *ngIf="showProductDropdown && getFilteredProducts().length > 0">
                                    <div class="dropdown-item" 
                                         *ngFor="let product of getFilteredProducts()"
                                         (mousedown)="selectProduct(product)"
                                         [class.selected]="selectedProduct?.value === product.value">
                                        {{product.name}}
                                    </div>
                                </div>
                                <div class="dropdown-list" *ngIf="showProductDropdown && getFilteredProducts().length === 0">
                                    <div class="dropdown-item no-results">No products found</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Quantity</label>
                            <input formControlName="quantity" type="text" placeholder="Enter Quantity" />
                        </div>
                        <div class="form-group">
                        </div>
                    </div>

                    <!-- Variation Selection Section -->
                    <div class="variation-section">
                        <h3>All Variation List</h3>
                        
                        <!-- Search Bar -->
                        <div class="search-container">
                            <mat-icon class="search-icon">search</mat-icon>
                            <input type="text" placeholder="Search variations..." class="search-input" 
                                   [(ngModel)]="searchTerm" [ngModelOptions]="{standalone: true}" 
                                   (keyup)="applyFilter($event)">
                        </div>

                        <!-- Variation Table -->
                        <div class="variation-table-container">
                            <table class="variation-table">
                                <thead>
                                    <tr>
                                        <th>VARIATION NAME</th>
                                        <th>VARIATION VALUE</th>
                                        <th>ACTION</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let variation of filteredVariations; let i = index">
                                        <td>{{variation.name}}</td>
                                        <td>
                                            <input type="text" 
                                                   class="variation-value-input" 
                                                   [(ngModel)]="variation.value" 
                                                   [ngModelOptions]="{standalone: true}"
                                                   placeholder="Enter value"
                                                   (blur)="updateVariationValue(i, variation.value)">
                                        </td>
                                        <td>
                                            <button type="button" 
                                                    class="btn-add-variation" 
                                                    [class.btn-added]="isVariationSelected(variation)"
                                                    [disabled]="isVariationSelected(variation) || !variation.value.trim()"
                                                    (click)="addVariationToSelected(variation)">
                                                {{isVariationSelected(variation) ? 'Added' : 'Add'}}
                                            </button>
                                        </td>
                                    </tr>
                                    <tr *ngIf="filteredVariations.length === 0" class="empty-row">
                                        <td colspan="3">
                                            <mat-icon>search_off</mat-icon>
                                            <div>No variations found</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Selected Variations Display -->
                    <div class="selected-variations-section" *ngIf="selectedVariations.length > 0">
                        <h4>Selected Variations</h4>
                        <div class="variation-tags-container">
                            <div class="variation-tag" *ngFor="let variation of selectedVariations; let i = index">
                                <span class="variation-text">{{variation.name}} - {{variation.value}}</span>
                                <button type="button" class="remove-tag" (click)="removeSelectedVariation(i)">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" [disabled]="selectedVariations.length === 0">Add</button>
                        <button type="reset" class="btn btn-outline">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>